<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSE Calendar</title>
    <style>
        body { font-family: Arial, sans-serif; }
        #events { margin-top: 20px; }
        .event { margin: 5px 0; }
    </style>
</head>
<body>
    <h1>SSE Calendar</h1>
    <form id="connectForm">
        <input type="text" id="userInput" placeholder="Add a username" required>
        <button type="submit">Connect</button>
    </form>
    <form id="eventForm">
        <input type="text" id="eventInput" placeholder="Add a new event" required>
        <button type="submit">Add Event</button>
    </form>
    <div id="events"></div>

    <script>
        const url = "https://localhost:7266/Calender";
        var eventSource = null;
        const connectForm = document.getElementById('connectForm');
        const eventForm = document.getElementById('eventForm');
        const eventInput = document.getElementById('eventInput');
        const eventsDiv = document.getElementById('events');
        connectForm.addEventListener('click', (e) => {
            e.preventDefault();
            const user = { name: userInput.value };
            
            eventSource = new EventSource(url+'/events?name='+user.name);
        });
        while (eventSource) {
            eventSource.onmessage = (message) => {
                const event = JSON.parse(message.data);
                addEventToDOM(event);
            };
        }

        eventForm.addEventListener('click', (e) => {
            e.preventDefault();
            if(eventInput.value=='') return;
            const eventData = { 
                'EventDate': new Date() ,
                'Name': eventInput.value,
            };
            fetch(url+'/add-event', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify( eventData)
            });
            eventInput.value = '';
        });

        function addEventToDOM(event) {
            const eventDiv = document.createElement('div');
            eventDiv.className = 'event';
            eventDiv.textContent = event.name;
            eventsDiv.appendChild(eventDiv);
        }
    </script>
</body>
</html>